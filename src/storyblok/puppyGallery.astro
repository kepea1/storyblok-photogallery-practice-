---
import { storyblokEditable } from "@storyblok/astro";
import StoryblokComponent from "@storyblok/astro/StoryblokComponent.astro";

const { blok } = Astro.props;
---

<div id="image-container-" class="border-2 border-red-600">
  <h1>{blok.heading}</h1>
  <h1>Puppy Gallery</h1>
  <img
    id="image-fadein"
    src={blok.image[0].image.filename}
    alt="puppies!"
    class="transition-opacity duration-1000 ease-in-out opacity-100"
    data-images={JSON.stringify(
      blok.image.map((image) => image.image.filename)
    )}
  />
</div>

<script>
  const imageElement = document.getElementById("image-fadein");
  let imageArrayIndex = 0;

  function fadeIn() {
    imageElement.classList.remove("opacity-0");
    imageElement.classList.add("opacity-100");
  }

  function fadeOut() {
    imageElement.classList.remove("opacity-100");
    imageElement.classList.add("opacity-0");
  }

  // Function to update the current image index
  function updateImageIndex() {
    fadeOut();
    setTimeout(() => {
      let imageArray = JSON.parse(imageElement.dataset.images);
      imageArrayIndex = (imageArrayIndex + 1) % imageArray.length;
      imageElement.src = imageArray[imageArrayIndex];
      fadeIn();
    }, 1000); // Wait for the fade-out to finish before changing the image and fading in
  }

  // Call the function every 10 seconds
  setInterval(updateImageIndex, 5000);
</script>

<!-- i cant acesses blok.image from the front matter in the script below, but sending the array via the data atrubute it gets embedded into the HTML , making it avaibile client side.   -->

<!-- <script>
  // Access the data-* attribute
  let imageArray = JSON.parse(document.getElementById("image-fadein").dataset.images);

  let imageArrayIndex = 0;
  console.log(imageArrayIndex); // Should now log the array of image filenames

  // Function to update the current image index
  function updateImageIndex() {
    // console.log(imageArrayIndex);
    let imageArray = JSON.parse(
      document.getElementById("image-fadein").dataset.images
    );
    // console.log(imageArray); // Should now log the array of image filenames
    document.getElementById("image-fadein").src = imageArray[imageArrayIndex];
  }

  // Call the function every 10 seconds
  setInterval(updateImageIndex, 1000);
</script> -->
